# JTPCK Installer - Internal Notes

## Architecture Decisions

### Codex Telemetry
- Codex reads OTEL config from `~/.codex/config.toml`, NOT env vars
- `EnableCodexTelemetry()` writes config.toml with dual exporters:
  - `[otel.exporter.otlp-http]` → `/v1/logs` (token counts via `codex.sse_event`)
  - `[otel.trace_exporter.otlp-http]` → `/v1/traces` (request metadata)
- `CodexEnv()` only sets `CODEX_*` env vars, not OTEL vars (they'd be ignored)

### Claude Telemetry
- Uses standard OTEL env vars via `baseOTELEnv()`
- Wrapper script sets all necessary env vars

### Gemini Telemetry
- Uses env vars AND `~/.gemini/settings.json`
- Both are configured by installer

## Server-side Notes
- `otlp_trace_parser.rb` only accepts `codex.sse_event` (not `codex.api_request`)
- This prevents duplicate events (traces send `codex.api_request` with unknown model)

## Security
- Config files use 0644 permissions
- Consider changing to 0600 for files with auth tokens (codex config.toml, jtpck config.json)
